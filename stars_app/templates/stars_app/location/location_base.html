{% extends 'stars_app/base.html' %}
{% load static %}
{% load custom_filters %}
{% block body_class %}location-details-page{% endblock %}

<!-- Extra header content -->
{% block extra_head %}
<link href="{% static 'css/location/location.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="location-details-page"
     data-location-id="{{ location.id }}"
     data-is-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}"
     data-is-owner="{% if is_owner %}true{% else %}false{% endif %}"
     data-current-username="{{ user.username|default:'' }}"
     data-location-longitude="{{ location.longitude }}"
     data-location-latitude="{{ location.latitude }}"
     data-location-name="{{ location.name|escapejs }}"
     data-location-formatted-address="{{ location.formatted_address|escapejs }}"
     data-user-has-reviewed="{% if user_has_reviewed %}true{% else %}false{% endif %}">
    {% csrf_token %}

    <div class="location-details-container">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-header">
                <div class="hero-title-section">
                    <h1>{{ location.name }}</h1>
                    {% if location.is_verified %}
                        <span class="verification-badge" title="Verified on {{ location.verification_date|date:'M d, Y' }}">
                            <i class="fas fa-check-circle"></i>
                            Verified
                        </span>
                    {% endif %}
                    <div class="hero-rating">
                        <div class="rating-display">
                            {% for i in "12345"|make_list %}
                                {% if forloop.counter <= average_rating %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="rating-count">{{ total_reviews }} review{{ total_reviews|pluralize }}</span>
                    </div>
                </div>
                <div class="hero-actions">
                    {% if user.is_authenticated %}
                        <button class="hero-action-btn favorite-button" type="button" id="favoriteButton">
                            <i class="fas fa-heart"></i>
                            <span id="favoriteText">Favorite</span>
                        </button>
                        
                    {% endif %}
                    <a href="{% url 'map' %}?lat={{ location.latitude }}&lng={{ location.longitude }}&zoom=12"
                       class="hero-action-btn view-map-button">
                        <i class="fas fa-map"></i>
                        View on Map
                    </a>
                </div>
            </div>
        </div>


        <!-- About Section -->
        <div class="about-section">
            <h2>About this Location</h2>
            <p class="location-description">
                {% if location.description %}
                    {{ location.description }}
                {% else %}
                    This astronomical viewing location offers exceptional stargazing conditions. Perfect for observing deep sky objects, the Milky Way, and celestial events.
                {% endif %}
            </p>
        </div>

        <!-- Astronomy Data Section -->
        <div class="astronomy-data-section">
            <div class="data-grid">
                <div class="data-item">
                    <div class="data-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="data-content">
                        <h3>Coordinates</h3>
                        <p>{{ location.latitude|floatformat:4 }}, {{ location.longitude|floatformat:4 }}</p>
                    </div>
                </div>
                <div class="data-item">
                    <div class="data-icon elevation">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <div class="data-content">
                        <h3>Elevation</h3>
                        <p>{{ location.elevation|floatformat:0 }} meters</p>
                    </div>
                </div>
                <div class="data-item">
                    <div class="data-icon calendar">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="data-content">
                        <h3>Best Viewing Months</h3>
                        <p>{% if location.administrative_area == "Hawaii" %}Year-round optimal{% elif location.country == "United States" %}April - September{% else %}Check local conditions{% endif %}</p>
                    </div>
                </div>
                <div class="data-item">
                    <div class="data-icon access">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="data-content">
                        <h3>Access Information</h3>
                        <p>{% if location.verification_notes %}{{ location.verification_notes }}{% else %}Check local conditions and accessibility before visiting. {% if location.is_verified %}This location has been verified.{% endif %}{% endif %}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reviews Section -->
        {% include 'stars_app/location/location_reviews.html' %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- Location Scripts -->
<script type="module" src="{% static 'js/location/location_init.js' %}"></script>
<script src="{% static 'js/location/location_reviews.js' %}"></script>
<script src="{% static 'js/location/location_base.js' %}"></script>
{% endblock %}